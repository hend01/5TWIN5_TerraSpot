version: "3"
services:
  event-ms:
    image: event-ms
    build: .
    restart: always
    ports:
      - 8088:8088
    environment:
      MYSQL_HOST: mysqldb
      MYSQL_USER: root
      MYSQL_PASSWORD: root
      MYSQL_PORT: 3306
      EUREKA_CLIENT_SERVICEURL_DEFAULTZONE: http://eureka-server:8761/eureka/
    networks:
      - my-network
  mysqldb:
    container_name: mysqldb
    image: "mysql:8"
    environment:
      MYSQL_DATABASE: Event-MS
      MYSQL_ROOT_PASSWORD: root
    ports:
      - 3307:3306
    networks:
      - my-network
  eureka-server:
    image: eureka-docker
    restart: always
    ports:
      - 8761:8761
    networks:
      - my-network
  Apigateway:
    ports:
      - 8086:8086
    image: "gateway-server:v1"
    restart: always
    depends_on:
      - eureka-server
      - event-ms
    environment:
      EUREKA_CLIENT_SERVICEURL_DEFAULTZONE: http://eureka-server:8761/eureka/
      EUREKA_INSTANCE_LEASERENEWALINTERVALINSECONDS: 10
      EUREKA_INSTANCE_LEASEEXPIRATIONDURATIONINSECONDS: 30
      SPRING_CLOUD_GATEWAY_ROUTES_0_ID: EventServices
      SPRING_CLOUD_GATEWAY_ROUTES_0_URI: http://event-ms:8088
      SPRING_CLOUD_GATEWAY_ROUTES_0_PREDICATES_0: Path=/events/**
    networks:
      - my-network
networks:
  my-network:
